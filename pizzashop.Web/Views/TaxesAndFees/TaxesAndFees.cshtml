@{
    ViewData["Title"] = "User page";
}

<link rel="stylesheet" href="~/css/TaxesAndFees.css" />

<div class="w-100 main-content px-lg-5 px-sm-4 px-4">

    <!-- heading text -->

    <div class="w-100 heading-back-button p-2">
        <div class="heading-text">
            <h1><b>Taxes/Fees</b></h1>
        </div>
        <div class="back-to-button d-flex gap-3 align-items-center">
            <div class="position-relative">
                <input class="search form-control me-2 border-0" id="searchTax" type="text" placeholder="Search"
                    aria-label="Search">
                <i class="bi bi-search custom-icon"></i>
            </div>
            <a class="add-tax">
                <button class="back-button">
                    <span>+ Add Tax</span>
                </button>
            </a>
        </div>
    </div>

<div id="table-container"></div>
</div>

<div></div>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $(document).ready(function () {

        let currentPage = @ViewBag.CurrentPage;
        let searchQuery = "@ViewBag.SearchQuery" || "";

        loadUserTable(1);

        function loadUserTable(page) {
            let pageSize = $("#pageSizeTax").val();
            let search = $("#searchTax").val(); 

            $.ajax({
                url: "/TaxesAndFees/TaxesAndFees",
                type: "GET",
                data: { page: page, pageSize: pageSize, search: search },
                success: function (data) {
                    console.log(data);
                    $("#table-container").html(data);
                    currentPage = page;
                },
                error: function () {
                    alert("Failed to load data.");
                }
            });
        }

        $("#tax-table").on("click", ".pagination-link", function (e) {
            e.preventDefault();
            let page = $(this).data("page");

            if (page > 0) {
                loadUserTable(page);
            }
        });

        $("#tax-table").on("change", "#pageSizeTax", function () {
            loadUserTable(1);
        });

        // Trigger search on input change (with delay to prevent excessive calls)

        let searchTimer;
        $("#searchTax").on("input", function () {
            clearTimeout(searchTimer);
            searchTimer = setTimeout(function () {
                loadUserTable(1); // Reset to page 1 when searching
            }, 500); // 500ms delay to avoid excessive requests
        });


    });

</script>
